<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Продажа билетов в кино на Vue</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 20px auto;
    padding: 0 15px;
  }
  button {
    padding: 8px 12px;
    margin: 5px 3px;
    cursor: pointer;
  }
  .seat {
    display: inline-block;
    width: 30px; height: 30px;
    line-height: 30px;
    margin: 3px;
    border: 1px solid #333;
    text-align: center;
    user-select: none;
  }
  .taken {
    background: #ccc;
    cursor: not-allowed;
  }
  .selected {
    background: #4caf50;
    color: white;
  }
</style>
</head>
<body>

<div id="app">
  <h1>Кинотеатр</h1>

  <!-- Этап выбора фильма -->
  <div v-if="step === 'movies'">
    <h2>Выберите фильм</h2>
    <div v-for="movie in movies" :key="movie.id" style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px;">
      <img :src="movie.poster" alt="" width="100" style="vertical-align: middle; margin-right: 10px;">
      <strong>{{ movie.title }}</strong> ({{ movie.duration }} мин, {{ movie.genre }})
      <br />
      <button @click="selectMovie(movie)">Купить билет</button>
    </div>
  </div>

  <!-- Этап выбора сеанса -->
  <div v-if="step === 'schedule'">
    <h2>Выберите сеанс для "{{ selectedMovie.title }}"</h2>
    <button v-for="time in showtimes" :key="time" @click="selectShowtime(time)">
      {{ time }}
    </button>
    <br /><br />
    <button @click="step = 'movies'">Назад</button>
  </div>

  <!-- Этап выбора мест -->
  <div v-if="step === 'seats'">
    <h2>Выберите места (сеанс {{ selectedShowtime }})</h2>
    <div>
      <span
        v-for="seat in seats"
        :key="seat.id"
        class="seat"
        :class="{
          taken: seat.taken,
          selected: selectedSeats.includes(seat.id)
        }"
        @click="toggleSeat(seat)"
      >
        {{ seat.id }}
      </span>
    </div>
    <br />
    <button @click="step = 'schedule'">Назад</button>
    <button @click="toPayment" :disabled="selectedSeats.length === 0">Далее</button>
  </div>

  <!-- Этап оплаты -->
  <div v-if="step === 'payment'">
    <h2>Оплата билетов</h2>
    <p>Фильм: <strong>{{ selectedMovie.title }}</strong></p>
    <p>Сеанс: <strong>{{ selectedShowtime }}</strong></p>
    <p>Места: <strong>{{ selectedSeats.join(', ') }}</strong></p>

    <form @submit.prevent="pay">
      <label>
        Имя:<br />
        <input v-model="paymentName" required />
      </label>
      <br /><br />
      <label>
        Номер карты:<br />
        <input v-model="paymentCard" pattern="\\d{16}" maxlength="16" required title="16 цифр" />
      </label>
      <br /><br />
      <button type="submit">Оплатить</button>
    </form>
    <br />
    <button @click="step = 'seats'">Назад</button>
  </div>

  <!-- Подтверждение -->
  <div v-if="step === 'confirmation'">
    <h2>Спасибо за покупку!</h2>
    <p>Ваш билет забронирован.</p>
    <button @click="reset">Купить ещё</button>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>

  alert("Accept all coockies?")

  const { createApp, ref, reactive } = Vue;

  createApp({
    setup() {
      const step = ref('movies');

      const movies = [
        { id: 1, title: 'Фильм 1', duration: 120, genre: 'Драма', poster: 'https://via.placeholder.com/100x150?text=Фильм+1' },
        { id: 2, title: 'Фильм 2', duration: 90, genre: 'Комедия', poster: 'https://via.placeholder.com/100x150?text=Фильм+2' },
      ];

      const showtimes = ['18:00', '21:00'];

      const seats = reactive([
        { id: 'A1', taken: false },
        { id: 'A2', taken: true },
        { id: 'A3', taken: false },
        { id: 'A4', taken: true },
        { id: 'B1', taken: false },
        { id: 'B2', taken: true },
        { id: 'B3', taken: false },
        { id: 'B4', taken: true },
      ]);

      const selectedMovie = ref(null);
      const selectedShowtime = ref(null);
      const selectedSeats = ref([]);
      const paymentName = ref('');
      const paymentCard = ref('');

      function selectMovie(movie) {
        selectedMovie.value = movie;
        step.value = 'schedule';
      }

      function selectShowtime(time) {
        selectedShowtime.value = time;
        selectedSeats.value = [];
        step.value = 'seats';
      }

      function toggleSeat(seat) {
        if (seat.taken) return;

        const index = selectedSeats.value.indexOf(seat.id);
        if (index === -1) {
          selectedSeats.value.push(seat.id);
        } else {
          selectedSeats.value.splice(index, 1);
        }
      }
       function toPayment() {
        if (selectedSeats.value.length === 0) {
          alert('Выберите хотя бы одно место');
          return;
        }
        step.value = 'payment';
      }

      function pay() {
        alert(`Спасибо, ${paymentName.value}! Оплата прошла успешно.`);
        step.value = 'confirmation';
      }

      function reset() {
        selectedMovie.value = null;
        selectedShowtime.value = null;
        selectedSeats.value = [];
        paymentName.value = '';
        paymentCard.value = '';
        step.value = 'movies';
      }

      return {
        step, movies, showtimes, seats,
        selectedMovie, selectedShowtime, selectedSeats,
        paymentName, paymentCard,
        selectMovie, selectShowtime, toggleSeat,
        toPayment, pay, reset,
      }
     
    }
  }).mount('#app');
</script>

</body>
</html>
